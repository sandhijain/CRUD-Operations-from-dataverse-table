<!DOCTYPE html>
<html>

<head>
  <title>Pop-up Form</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style> /* Custom styles for the modal and form */
    .modal-content {
      border-radius: 0;
    }
  
    .modal-header {
      background-color: #2F3C7E;
      border-bottom: none;
    }
  
    .modal-title {
      font-weight: bold;
      color: #FBEAEB;
  
    }
  
  
    .modal-footer {
      background-color: #FBEAEB;
      border-top: none;
    }
  
    /* Additional styles specific to form elements, if needed */
  
  
    /* Custom styles for the pop-up form */
    .modal-body {
      padding: 20px;
    }
  
    .form-group {
      margin-bottom: 15px;
    }
  
    label {
      font-weight: bold;
    }
  
    input[type="text"],
    input[type="email"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #FBEAEB;
  
      border-radius: 4px;
    }
  
    .invalid-feedback {
      color: red;
      margin-top: 5px;
    }
  
    /* Additional styles specific to form elements, if needed */
  
    /* Styles for the listing container */
    #listing-container {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
  
    /* Styles for the table */
    table {
      width: 100%;
      border-collapse: collapse;
    }
  
    /* Styles for the table header */
    th {
      background-color: #FBEAEB;
  
      padding: 8px;
      text-align: left;
    }
  
    /* Styles for the table body */
    td {
      padding: 8px;
      border-bottom: 1px solid #FBEAEB;
  
    }
  
    /* Styles for the horizontal line */
    hr {
      margin: 20px 0;
      border: none;
      border-top: 1px solid #FBEAEB;
  
    }
  
    .edit-button {
      background-color: #2F3C7E;
      color: #FBEAEB;
      border-radius: 4px;
  
    }
  
    .delete-button {
      background-color: #2F3C7E;
      color: #FBEAEB;
      border-radius: 4px;
    }
  
  
    #loadingIndicator {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9999;
    }
    
    .loader {
      border: 8px solid #f3f3f3; /* Light grey */
      border-top: 8px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 2s linear infinite;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #loadingIndicator.loading {
      background-color: rgba(0, 0, 0, 0.7); /* Darker background color */
    }
    
  
    .record:hover {
      outline: 4px solid#2F3C7E;
      transform: scale(1.01);
      transition: transform 0.3s ease;
      background-color:#FBEAEB ;
    }</style>

  <script>  
    // Function to dynamically generate the HTML for each listing
    // Update the generateListingHTML function
    function generateListingHTML(listing) {
        var name = listing["Name"];
        var age = listing["Age"];
        var mobile = listing["Mobile No"];
        var email = listing["Email ID"];
        var salary = listing["Salary"];
        var occupation = listing["Occupation"];
      
        return `
          <tr class="record">
          <td></td>
            <td>${name}</td>
            <td>${age}</td>
            <td>${mobile}</td>
            <td>${email}</td>
            <td>${salary}</td>
            <td>${occupation}</td>
            <td>
            <button type="button" class="btn edit-button" data-toggle="modal" data-target="#editModal" data-id="${mobile}" data-name="${name}" data-age="${age}" data-email="${email}" data-salary="${salary}" data-occupation="${occupation}">
            Edit
          </button>
         </td>
      <td>
              <button class="btn btn-danger delete-button" onclick="handleDelete('${name}', '${age}', '${mobile}', '${email}', '${salary}', '${occupation}')">
                Delete
               </button>
              </td>
               
          </tr>`;
      }

      
  // Function to dynamically generate the HTML for the table
function generateTableHTML(data) {
    let tableHTML = `
      <table id="data-table">
        <thead>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Age</th>
            <th>Mobile</th>
            <th>Email</th>
            <th>Salary</th>
            <th>Occupation</th>
            <th>Edit</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
    `;
  
    data.forEach((listing) => {
        tableHTML += generateListingHTML(listing);
      });
    
      tableHTML += `
          </tbody>
        </table>
      `;
    
      return tableHTML;
    };
  
  // Example data (replace with your own data)
  // Make a GET request to the API
  var myJson;
  

  const ListOfItems = async () => {
      try {
        const response = await fetch("https://prod-09.westus.logic.azure.com:443/workflows/63a4cba45ebe4669a60686011c165c14/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=okxxcu6UHpmEQGDxuRcSnHf4ibqFMyD10gLrCMw62rs");
        myJson = await response.json();
     

        if (myJson.payload && Array.isArray(myJson.payload)) {
          const tableHTML = generateTableHTML(myJson.payload);
          document.getElementById("data").innerHTML = tableHTML;
        } else {
          console.error("Invalid payload data in the response.");
        }
      } catch (error) {
        console.error(error);
      }
    };
    function handleDataSubmit() {
      document.getElementById("loadingIndicator").style.display = "block";
      let name = $("#name").val();
      let age = $("#age").val();
      let mobile = $("#mobile").val();
      let email = $("#email").val();
      let salary = $("#salary").val();
      let occupation = $("#occupation").val();
    
      let myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
    
      let raw = JSON.stringify({
        name: name,
        age: age,
        mobile: mobile,
        email: email,
        salary: salary,
        occupation: occupation,
      });
    
      let requestOptions = {
        method: "POST",
        headers: myHeaders,
        body: raw,
        redirect: "follow",
      };
    
      fetch("https://prod-30.westus.logic.azure.com:443/workflows/a3257552e2bc40629fb68ec2bcb66ce7/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=QTemPOpSr0uFQ7moRGuCsepWOZoy1QKyYBXxfe3Ap90", requestOptions)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not OK");
          }
          return response.json();
        })
        .then((result) => {
          console.log(result.status);
          if (result.status === 200) {
            console.log(result.status);
            document.getElementById("data").innerHTML = "";
          }
    
          // Hide the loading indicator after the operation is complete
          document.getElementById("loadingIndicator").style.display = "none";
    
          // Close the modal and reset the form
          $("#myModal").modal("hide");
          $("#myForm")[0].reset();
    
          ListOfItems();
        })
        .catch((error) => {
          // Display an error message to the user
          console.log("Error:", error);
          alert("An error occurred. Please try again later.");
    
          // Hide the loading indicator in case of an error
          document.getElementById("loadingIndicator").style.display = "none";
        });
    }
    
 

// Handle record deletion
function handleDelete(name, age, mobile, email, salary, occupation) {
    // Show the loading indicator
    document.getElementById("loadingIndicator").style.display = "block";
    let data = {
      name: name,
      age: age,
      mobile: mobile,
      email: email,
      salary: salary,
      occupation: occupation
    };
  
    //console.log("Deleting item:", name, age, mobile, email, salary, occupation);

    let requestOptions = {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    };
  
    fetch("https://prod-106.westus.logic.azure.com:443/workflows/d90538b78ab642fe94ed960e62e0595c/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Ps1EdF9auNHNgqDeHaGhTBFlFNH5JcKPtHTWDlVk8UQ", requestOptions)
      .then((response) => response.json())
      .then((result) => {
        if (result.status === 200) {
          // Delete succeeded, update the table

          document.getElementById("data").innerHTML = "";
      // Hide the loading indicator after the operation is complete
      document.getElementById("loadingIndicator").style.display = "none";
          ListOfItems();
        } else {
          alert("Error deleting the record.");
        }
     
      })
      .catch((error) => console.log("error", error));
  }
 

  
     
    ListOfItems();

    // Function to handle data update
    function handleDataUpdate(name, age, mobile, email, salary, occupation) {
      document.getElementById("loadingIndicator").style.display = "block";
        let myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
    
        let raw = JSON.stringify({
            name: name,
            age: age,
            mobile: mobile,
            email: email,
            salary: salary,
            occupation: occupation,
          });

          console.log(raw);
    
          let requestOptions = {
            method: "POST",
            headers: myHeaders,
            body: raw,
            redirect: "follow",
          };
      
     
      fetch("https://prod-50.westus.logic.azure.com:443/workflows/f932d7c0173f4fd5bf19e7b1049c3f55/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=NW0ViogQYJyLS94k1R3MO3BoFx4WkyRtwEIFi7DKztc", requestOptions)
        .then((response) => response.json())
        .then((result) => {
            if (result.status === 200) {
                document.getElementById("data").innerHTML = "";
            // Hide the loading indicator after the operation is complete
            document.getElementById("loadingIndicator").style.display = "none";
                ListOfItems();
              } else {
                alert("Failed to update data");
              }
              })
              .catch((error) => console.log("error", error));
    }

     
var mobileno;

// Edit Button click event listener
$(document).on("click", ".edit-button", function() {
     mobileno = $(this).data("id");
     var name = $(this).data("name");
     var age = $(this).data("age");
    var email = $(this).data("email");
    var salary = $(this).data("salary");
    var occupation = $(this).data("occupation");


  // Prefill the form inputs
  $("#editName").val(name);
  $("#editAge").val(age);
  $("#editEmail").val(email);
  $("#editSalary").val(salary);
  $("#editOccupation").val(occupation);

    

 // Attach input event listeners to the form fields
  $("#editAge").on("input", validateAge);
  $("#editSalary").on("input", validateSalary);
  $("#editEmail").on("input", validateEmail);

  function validateAge() {
    let age = $("#editAge").val();
    if (isNaN(age)) {
      $("#editAge").addClass("is-invalid");
      $("#editAgeWarning").text("Please enter a valid number for age.").show();
    } else {
      $("#editAge").removeClass("is-invalid");
      $("#editAgeWarning").hide();
    }
  }

  function validateSalary() {
    let salary = $("#editSalary").val();
    if (isNaN(salary)) {
      $("#editSalary").addClass("is-invalid");
      $("#editSalaryWarning").text("Please enter a valid number for salary.").show();
    } else {
      $("#editSalary").removeClass("is-invalid");
      $("#editSalaryWarning").hide();
    }
  }

  function validateEmail() {
    let email = $("#editEmail").val();
    let emailPattern = /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;
    if (!emailPattern.test(email)) {
      $("#editEmail").addClass("is-invalid");
      $("#editEmailWarning").text("Please enter a valid email address.").show();
    } else {
      $("#editEmail").removeClass("is-invalid");
      $("#editEmailWarning").hide();
    }
  }

   // Show the modal
   $("#editModal").modal("show");


  $("#editForm").submit(function(event) {
    
    event.preventDefault();

   

      var name = $("#editName").val();
      var age = $("#editAge").val();
      //var mobile = $("#editMobile").val(); // Commented out as it wasn't defined in the provided code
      var email = $("#editEmail").val();
      var salary = $("#editSalary").val();
      var occupation = $("#editOccupation").val();
      var mobile = mobileno.toString();

      // Perform update using the API endpoint
      handleDataUpdate(name, age, mobile, email, salary, occupation);
      console.log("Form submitted");
      // Close the modal and reset the form
      $("#editModal").modal("hide");
      $("#editForm")[0].reset();
    
  });

 
   
  });

  $(document).ready(function() {
    // Open the form when the button is clicked
    $("#openFormButton").click(function() {
      $("#myModal").modal('show');
    
    });

     // Function to reset the form
  function resetForm() {
    $("#myForm")[0].reset();
    $(".invalid-feedback").hide(); // Hide all error messages
  }
 // Attach input event listeners to the form fields
 $("#age").on("input", validateAge);
 $("#salary").on("input", validateSalary);
 $("#mobile").on("input", validateMobile);
 $("#email").on("input", validateEmail);

 function validateAge() {
   var age = $("#age").val();
   if (isNaN(age)) {
     $("#age").addClass("is-invalid");
     $("#ageWarning").text("Please enter a valid number for age.").show();
   } else {
     $("#age").removeClass("is-invalid");
     $("#ageWarning").hide();
   }
 }

 function validateSalary() {
   var salary = $("#salary").val();
   if (isNaN(salary)) {
     $("#salary").addClass("is-invalid");
     $("#salaryWarning").text("Please enter a valid number for salary.").show();
   } else {
     $("#salary").removeClass("is-invalid");
     $("#salaryWarning").hide();
   }
 }

 function validateMobile() {
   var mobile = $("#mobile").val();
   var isValid = /^\d{10}$/.test(mobile) && /^[6-9]/.test(mobile);
   
   if (!isValid) {
     if (/^\d{10}$/.test(mobile)) {
       $("#mobileWarning").text("Please enter an Indian mobile number (Begins with 6,7,8 or 9).").show();
     } else {
       $("#mobileWarning").text("Please enter a 10-digit mobile number.").show();
     }
     $("#mobile").addClass("is-invalid");
   } else {
     $("#mobile").removeClass("is-invalid");
     $("#mobileWarning").hide();
   }
 }
 
 
 function validateEmail() {
   var email = $("#email").val();
   var emailPattern = /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;
   if (!emailPattern.test(email)) {
     $("#email").addClass("is-invalid");
     $("#emailWarning").text("Please enter a valid email address.").show();
   } else {
     $("#email").removeClass("is-invalid");
     $("#emailWarning").hide();
   }
 }
  
   
  
    $("#myForm").submit(function(event) {
      event.preventDefault(); // Prevent form submission
  
     
      
   

     // Get form values
      var name = $("#name").val();
      var age = $("#age").val();
      var mobile = $("#mobile").val();
      var email = $("#email").val();
      var salary = $("#salary").val();
      var occupation = $("#occupation").val();
  
      
      // Process the form data (e.g., send it to the server)
      handleDataSubmit();
       // Close the form
       $("#myModal").modal('hide');
        resetForm();
    });
    
  // Handle form reset
  $("#myModal").on("hidden.bs.modal", resetForm);
});
  </script>


  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"
          style="font-size: 30px; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #2F3C7E;">
          Employee Details Form
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item">
          <button type="button" class="btn btn-primary" id="openFormButton"
            style="color:#FBEAEB; background-color: #2F3C7E;">Open Form</button>
        </li>
      </ul>
    </div>
  </nav>

  <!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">

        <!-- Modal Header -->

        <div class="modal-header">
          <h4 class="modal-title">Employee Form</h4>

          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>


        <!-- Modal body -->
        <div class="modal-body">
          <form id="myForm">
            <div class="form-group">
              <label for="name">Name:</label>
              <input type="text" class="form-control" id="name" required>
            </div>
            <div class="form-group">
              <label for="age">Age:</label>
              <input type="text" class="form-control" id="age" required>
              <div id="ageWarning" class="invalid-feedback"></div>
            </div>

            <div class="form-group">
              <label for="mobile">Mobile No:</label>
              <input type="text" class="form-control" id="mobile" required>
              <div id="mobileWarning" class="invalid-feedback"></div>
            </div>
            <div class="form-group">
              <label for="email">Email ID:</label>
              <input type="email" class="form-control" id="email" required>
              <div id="emailWarning" class="invalid-feedback"></div>
            </div>

            <div class="form-group">
              <label for="salary">Salary:</label>
              <input type="text" class="form-control" id="salary" required>
              <div id="salaryWarning" class="invalid-feedback"></div>
            </div>



            <div class="form-group">
              <label for="occupation">Occupation:</label>
              <input type="text" class="form-control" id="occupation" required>
            </div>
            <button type="submit" class="btn btn-primary"
              style="color: #FBEAEB; background-color: #2F3C7E;">Save</button>
            <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal" id="clear-button">Clear</button> -->
            
  
          </form>
        </div>

      </div>
    </div>
  </div>
  <hr />
  <ul id="listing-container">
    <!-- List items will be dynamically added here -->
  </ul>


  <table id="container">
    <tbody id="data"></tbody>
  </table>


  <!-- Edit Modal -->
  <div class="modal fade" id="editModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Update Form</h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="editForm" onsubmit="event.preventDefault();">
            <div class="form-group">
              <label for="editName">Name</label>
              <input type="text" class="form-control" id="editName" required>
            </div>
            <div class="form-group">
              <label for="editAge">Age</label>
              <input type="text" class="form-control" id="editAge" required>
              <div id="editAgeWarning" class="invalid-feedback"></div>
            </div>
            <div class="form-group">
              <label for="editMobile">Mobile</label>
              <input type="text" class="form-control" id="editMobile" readonly>
            </div>
            <div class="form-group">
              <label for="editEmail">Email</label>
              <input type="email" class="form-control" id="editEmail" required>
              <div id="editEmailWarning" class="invalid-feedback"></div>
            </div>
            <div class="form-group">
              <label for="editSalary">Salary</label>
              <input type="text" class="form-control" id="editSalary" required>
              <div id="editSalaryWarning" class="invalid-feedback"></div>
            </div>
            <div class="form-group">
              <label for="editOccupation">Occupation</label>
              <input type="text" class="form-control" id="editOccupation" required>
            </div>
            <button type="submit" class="btn btn-primary" style="color: #FBEAEB; background-color: #2F3C7E;"
              id="updateButton">Update</button>
              
   

          </form>
        </div>
      </div>
    </div>
  </div>


  <div id="loadingIndicator">
    <div class="loader"></div>
    <div>Loading...</div>
  </div>



</body>

</html>